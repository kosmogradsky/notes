# Как справиться с трудным бекендом

Если на вашем проекте бекендеры не могут перестать без предупреждения вырубать сервера или менять форму данных, хотя это ломает ваш фронтенд, вот ваши потенциальные шаги:

1. **Обсудите проблемы с командой на бекенде**

    Для вас это очевидно, но бекенд может не догадываться, что вам очень трудно работать, когда сервера выключены, или что на исправление багов после изменения формы данных каждый раз нужно тратить время. Очень важно ясно дать понять ребятам на той стороне, что это блокирует вашу работу, а уже потом принимать превентивные меры. Дальше читайте, только если этот совет вам не помог.

2. **Подготовьте моковые данные, не удаляйте их, всегда обновляйте их**

    Это позволяет вашему фронтеду работать независимо, даже когда серверы не работают. С моками поведение приложения легче предсказать, что важно во время разработки. С моками фиксы после очередного изменения формы данных можно отложить до тех пор, пока текущие задачи не будут закрыты. Когда (или если) бекенд становится стабильным, всё равно полезно иметь моки, чтобы воспроизводить какие-то сложные баги или чтобы наверняка знать, что какой-нибудь баг точно не связан с бекендом.

3. **Адаптируйте данные, прежде чем передавать их в компоненты**

    Иногда данные с сервера выглядят так:

    ```json
    {
      "dt_month": 201801,
      "dev_id": 5,
      "geo_id": 1,
      "rch": 49819.5,
      "rch_p": 100,
    }
    ```

    Можно догататься, что значат `dt_month`, `dev_id`, `geo_id`, но трудно понять, зачем нужны `rch` and `rch_p`, и мы точно хотим избежать таких непонятных имен в нашей кодовой базе. Вкупе с частыми изменениями формы данных эта проблема может быть решена _адаптированием_ данных с помощью специальной функции:

    ```typescript
    interface Adapter {
      (data: SomeRawDataFromBackend): AdaptedData
    }
    ```
    Таким образом все преобразования данных содержатся внутри одной функции, которую удобно править, когда на бекенде что-то меняется.

4. **Валидируйте JSON-схемами или декодируйте через io-ts**

    [JSON-схема](https://json-schema.org/) позволяет описать данные в той форме, в которой вы ожидаете их получить, и проверить их на корректную форму, перед тем как использовать. На случай, если вдруг данные с бекенда изменять форму, когда приложение уже в продакшене, у вас будет возможность показать заботливое сообщение об ошибке вместо сломанного неверными данными интерфейса. Одна из самых популярных библиотек для работы с JSON-схемами — [Ajv](https://github.com/epoberezkin/ajv).
    
    Однако, если вы используете Тайпскрипт, то с JSON-схемами вам будет неудобно: статическая типизация и схемы описывают данные независимо друг от друга, то есть эти описания могут отличаться. Таким образом, данные которые пропустила JSON-схема всё равно могут сломать ваш типизированный код, если вы забудете их синхронизировать. В таком случае лучше использовать [io-ts](https://github.com/gcanti/io-ts), который интегрируется с Тайпскриптом и выводит все типы из единственного описания.